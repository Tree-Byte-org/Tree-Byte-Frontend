# Integrating Smart Contract

Example `CANSAO7W4JWZE445NXVN34IXMIZ2KZI6YM4HHEE3AZ7U737MC3ZOE67H`:
[View Contract on Explorer](https://stellar.expert/explorer/testnet/contract/CANSAO7W4JWZE445NXVN34IXMIZ2KZI6YM4HHEE3AZ7U737MC3ZOE67H).

I followed closely a [Comprehensive frontend guide for Stellar dapps](https://developers.stellar.org/docs/build/guides/dapps/frontend-guide) to connect to the smart contract.

We built a hook `hooks\use-token-purchase.ts` that handles the token purchase.

## Custom Hook: useTokenPurchase

The `useTokenPurchase` hook provides functions and state management to facilitate the process of connecting to the wallet and purchasing tokens through the smart contract.

Key Features:

- Wallet Connection: Checks if the wallet is connected and retrieves the public key.
- Token Purchase: Handles the token purchase transaction and manages loading states during the transaction process.
- Data Fetching: Fetches transaction data to confirm the transaction status and retrieve results.

The hook has 3 config variables:

```js
const CONTRACT_ID = "CANSAO7W4JWZE445NXVN34IXMIZ2KZI6YM4HHEE3AZ7U737MC3ZOE67H";
const NETWORK_PASSPHRASE = Networks.TESTNET;
const SOROBAN_URL = "https://soroban-testnet.stellar.org";
```

### Notes

`getTransaction` Does not work after the transaction is successful so we fetch data through http request.

We also use `@stellar/stellar-xdr-json` to decode the xdr data.

## Resources

- [Comprehensive frontend guide for Stellar dapps](https://developers.stellar.org/docs/build/guides/dapps/frontend-guide)
- [StellarSDK: Class Server](https://stellar.github.io/js-stellar-sdk/module-rpc.Server.html)
- [getTransaction](https://developers.stellar.org/docs/data/apis/rpc/api-reference/methods/getTransaction)
- [getTransaction with stellar lab web interface](https://lab.stellar.org/endpoints/rpc/get-transaction?$=network$id=testnet&label=Testnet&horizonUrl=https:////horizon-testnet.stellar.org&rpcUrl=https:////soroban-testnet.stellar.org&passphrase=Test%20SDF%20Network%20/;%20September%202015;&endpoints$params$transaction=37a7a3a046e3618f9b211c0168f8d7dfe727686fc32383acb1947dbc53e97449&xdrFormat=base64;;)
- [View XDR with stellar lab web interface](https://lab.stellar.org/xdr/view?$=network$id=testnet&label=Testnet&horizonUrl=https:////horizon-testnet.stellar.org&rpcUrl=https:////soroban-testnet.stellar.org&passphrase=Test%20SDF%20Network%20/;%20September%202015;&xdr$blob=AAAABAAAAAAAAAACAAAAAwAL7GoAAAAAAAAAAKCw3icdT0tODNZ+c3TD0FM7//Qo3P2qRISVSxOSYqWe0AAAAF0hseOgAC0LFAAAAHgAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAMAAAAAAAvsXAAAAABojqbVAAAAAAAAAAEAC+xqAAAAAAAAAACgsN4nHU9LTgzWfnN0w9BTO//0KNz9qkSElUsTkmKlntAAAABdIbHjoAAtCxQAAAB8AAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAADAAAAAAAL7GoAAAAAaI6nGwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAADC4AAAAAAAAAHYAAAAAAAAAAAAAAAEAAAAFAAAAAAAAA+EAAAACAAAAAAAAAAAAAAAB15KLcsJwPM//q9+uf9O9NUEpVqLl5//JtFDqLIQrTRzmEAAAABAAAAAAAAAAIAAAAPAAAAA2ZlZQAAAAASAAAAAAAAAACgsN4nHU9LTgzWfnN0w9BTO//0KNz9qkSElUsTkmKlntAAAAAoAAAAAAAAAAAAAAAAAAMfJAAAAAgAAAAAAAAAB15KLcsJwPM//q9+uf9O9NUEpVqLl5//JtFDqLIQrTRzmEAAAABAAAAAAAAAAIAAAAPAAAAA2ZlZQAAAAASAAAAAAAAAACgsN4nHU9LTgzWfnN0w9BTO//0KNz9qkSElUsTkmKlntAAAAAr////////////////////////////////////2nJAAAAFQAAAAEAAAAAAAAAAAAAAAIAAAAAAAAAAwAAAA8AAAAHZm5fY2FsbAAAAAANAAAAIBsgO//bibZJznW3q3fEXYjOlZR7DOHOQmwZ//T+//sFvLiAAAADwAAABRnZXRfcmVtYWluaW5nX3N1cHBseQAAAAEAAAABAAAAAAAAAAEbIDv24m2Sc51t6t3xF2IzpWUewzhzkJsGf0//v7Bby4gAAAAIAAAAAAAAAAgAAAA8AAAAJZm5fcmV0dXJuAAAAAAAADwAAABRnZXRfcmVtYWluaW5nX3N1cHBseQAAAAUAAAAAAAAD4QAAAAEAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAA8AAAAMY29yZV9tZXRyaWNzAAAADwAAAApyZWFkX2VudHJ5AAAAAAAFAAAAAAAAAAIAAAABAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAPAAAADGNvcmVfbWV0cmljcwAAAA8AAAALd3JpdGVfZW50cnkAAAAABQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAgAAAAAAAAACAAAADwAAAAxjb3JlX21ldHJpY3MAAAAPAAAAEGxlZGdlcl9yZWFkX2J5dGUAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAPAAAADGNvcmVfbWV0cmljcwAAAA8AAAARbGVkZ2VyX3dyaXRlX2J5dGUAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAPAAAADGNvcmVfbWV0cmljcwAAAA8AAAANcmVhZF9rZXlfYnl0ZQAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAA8AAAAMY29yZV9tZXRyaWNzAAAADwAAAA53cml0ZV9rZXlfYnl0ZQAAAAAABQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAgAAAAAAAAACAAAADwAAAAxjb3JlX21ldHJpY3MAAAAPAAAADnJlYWRfZGF0YV9ieXRlAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAPAAAADGNvcmVfbWV0cmljcwAAAA8AAAAPd3JpdGVfZGF0YV9ieXRlAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAA8AAAAMY29yZV9tZXRyaWNzAAAADwAAAA5yZWFkX2NvZGVfYnl0ZQAAAAAABQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAgAAAAAAAAACAAAADwAAAAxjb3JlX21ldHJpY3MAAAAPAAAAD3dyaXRlX2NvZGVfYnl0ZQAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAPAAAADGNvcmVfbWV0cmljcwAAAA8AAAAKZW1pdF9ldmVudAAAAAAABQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAgAAAAAAAAACAAAADwAAAAxjb3JlX21ldHJpY3MAAAAPAAAAD2VtaXRfZXZlbnRfYnl0ZQAAAAAFAAAAAAAAAAwAAAABAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAPAAAADGNvcmVfbWV0cmljcwAAAA8AAAAIY3B1X2luc24AAAAFAAAAAAAHClAAAAABAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAPAAAADGNvcmVfbWV0cmljcwAAAA8AAAAIbWVtX2J5dGUAAAAFAAAAAAATiCwAAAABAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAPAAAADGNvcmVfbWV0cmljcwAAAA8AAAARaW52b2tlX3RpbWVfbnNlY3MAAAAAAAAFAAAAAAAEdkkAAAABAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAPAAAADGNvcmVfbWV0cmljcwAAAA8AAAAPbWF4X3J3X2tleV9ieXRlAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAA8AAAAMY29yZV9tZXRyaWNzAAAADwAAABBtYXhfcndfZGF0YV9ieXRlAAAABQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAgAAAAAAAAACAAAADwAAAAxjb3JlX21ldHJpY3MAAAAPAAAAEG1heF9yd19jb2RlX2J5dGUAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAPAAAADGNvcmVfbWV0cmljcwAAAA8AAAATbWF4X2VtaXRfZXZlbnRfYnl0ZQAAAAAFAAAAAAAAAAA=&type=TransactionMeta;;)
- [XDR format](https://developers.stellar.org/docs/learn/fundamentals/data-format/xdr)
